<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë¥¶ÂçïÁ•ûÊé¢</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <script src="/static/js/vue.global.js"></script>
    <script src="/static/js/echarts.min.js"></script>
    <script src="/static/js/tailwindcss.js"></script>
    <link rel="stylesheet" href="/static/css/flatpickr.min.css">
    <script src="/static/js/flatpickr.js"></script>
    <script src="/static/js/zh.min.js"></script>
    <script src="/static/js/marked.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
        }

        .chart-container {
            height: 400px;
            width: 100%;
        }

        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        /* Custom Animations */
        @keyframes subtle-pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.95;
                transform: scale(1.02);
            }
        }

        .animate-pulse-slow {
            animation: subtle-pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes bounce-slight {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-2px);
            }
        }

        .animate-bounce-slight {
            animation: bounce-slight 2s ease-in-out infinite;
        }

        @keyframes breathe-blue {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
                background-color: rgba(238, 242, 255, 0.5);
            }

            50% {
                box-shadow: 0 0 10px 4px rgba(99, 102, 241, 0.2);
                background-color: rgba(224, 231, 255, 0.8);
                border-color: rgba(99, 102, 241, 0.6);
            }
        }

        .animate-breathe-blue {
            animation: breathe-blue 3s infinite ease-in-out;
        }

        @keyframes linkage-wiggle {

            0%,
            100% {
                transform: scale(1.12) rotate(0deg);
            }

            25% {
                transform: scale(1.12) rotate(-2deg);
            }

            50% {
                transform: scale(1.12) rotate(2deg);
            }

            75% {
                transform: scale(1.12) rotate(-1deg);
            }
        }

        .animate-linkage-wiggle {
            animation: linkage-wiggle 0.55s ease-in-out infinite;
        }

        /* Markdown Styles */
        .markdown-body ul {
            list-style-type: disc;
            padding-left: 1.5em;
            margin: 0.5em 0;
        }

        .markdown-body ol {
            list-style-type: decimal;
            padding-left: 1.5em;
            margin: 0.5em 0;
        }

        .markdown-body strong {
            font-weight: 700;
            color: #111827;
        }

        .markdown-body p {
            margin-bottom: 0.75em;
        }

        .markdown-body h1,
        .markdown-body h2,
        .markdown-body h3 {
            font-weight: 700;
            margin-top: 1em;
            margin-bottom: 0.5em;
            color: #1f2937;
        }

        .markdown-body blockquote {
            border-left: 4px solid #e5e7eb;
            padding-left: 1em;
            color: #4b5563;
            font-style: italic;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen text-gray-800">
    <div id="app" class="pb-10">
        <!-- Header -->
        <header
            class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-40 border-b border-gray-200 transition-all duration-300">
            <div class="container mx-auto px-6 py-3 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <img src="/static/img/logo.png" alt="Logo" class="h-10 w-auto object-contain"
                        onerror="this.style.display='none'">
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 tracking-tight">Ë¥¶ÂçïÁ•ûÊé¢</h1>
                        <p class="text-xs text-gray-500">Ë¥¶ÂçïÊô∫ËÉΩÂàÜÊûêÁ≥ªÁªü</p>
                    </div>
                </div>
                <nav class="flex bg-gray-100/50 p-1 rounded-lg">
                    <button @click="currentTab = 'upload'"
                        :class="['px-5 py-2 rounded-md text-sm font-medium transition-all duration-200', currentTab === 'upload' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-200/50']">
                        Â´åÁñë‰∫∫ÁÆ°ÁêÜ
                    </button>
                    <button @click="currentTab = 'dashboard'"
                        :class="['px-5 py-2 rounded-md text-sm font-medium transition-all duration-200', currentTab === 'dashboard' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-200/50']">
                        ‰ª™Ë°®Áõò
                    </button>
                    <button @click="currentTab = 'transactions'"
                        :class="['px-5 py-2 rounded-md text-sm font-medium transition-all duration-200', currentTab === 'transactions' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-200/50']">
                        ‰∫§ÊòìÊòéÁªÜ
                    </button>
                </nav>
            </div>
        </header>

        <!-- Floating Active Suspect Indicator -->
        <transition name="fade">
            <div v-if="activeSuspect"
                class="fixed left-6 top-32 z-40 flex flex-col items-center gap-2 group cursor-pointer transition-transform hover:scale-105"
                @click="currentTab = 'upload'" title="ÁÇπÂáªÂàáÊç¢Â´åÁñë‰∫∫">
                <div
                    class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 shadow-lg flex items-center justify-center text-white font-bold text-xl border-2 border-white ring-2 ring-blue-100 group-hover:ring-blue-300 transition-all">
                    {{ activeSuspect.name.charAt(0) }}
                </div>
                <span
                    class="bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium text-gray-700 shadow-sm border border-gray-100 group-hover:text-blue-600 group-hover:border-blue-200 transition-colors">
                    {{ activeSuspect.name }}
                </span>
            </div>
        </transition>


        <div class="container mx-auto px-6 py-8">
            <!-- Upload Section -->
            <div v-if="currentTab === 'upload'" class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-bold text-gray-800">Â´åÁñë‰∫∫Ê°£Ê°à</h2>
                    <div class="flex gap-4">
                        <div class="relative">
                            <input type="text" v-model="suspectSearch" @input="loadSuspects" placeholder="ÊêúÁ¥¢Â´åÁñë‰∫∫..."
                                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all w-64">
                            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        <button @click="openSuspectModal('create')"
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-700 hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4"></path>
                            </svg>
                            Êñ∞Âª∫Â´åÁñë‰∫∫
                        </button>
                    </div>
                </div>

                <!-- Suspect Cards Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div v-for="suspect in suspects" :key="suspect.id"
                        class="bg-white border border-gray-100 rounded-lg p-4 shadow-sm hover:shadow-md transition-all duration-300 group relative overflow-hidden">
                        <div class="flex items-center justify-between mb-3 relative z-10">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-lg shadow-inner">
                                    {{ suspect.name.charAt(0) }}
                                </div>
                                <div>
                                    <h3 class="text-base font-bold text-gray-900">{{ suspect.name }}</h3>
                                    <span class="text-xs text-gray-500">ID: {{ suspect.id }} | {{ suspect.file_count }}
                                        ‰ªΩË¥¶Âçï</span>
                                </div>
                            </div>
                            <button @click="openManageModal(suspect)"
                                class="text-gray-400 hover:text-gray-600 p-1.5 hover:bg-gray-100 rounded-full transition-colors"
                                title="ÁÆ°ÁêÜ">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                                    </path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </button>
                        </div>

                        <div class="flex gap-2 relative z-10">
                            <button @click="promptVerify(suspect)"
                                :class="['flex-1 py-2 rounded-md text-xs font-medium transition-all duration-200 shadow-sm', activeSuspect && activeSuspect.id === suspect.id ? 'bg-green-600 text-white' : 'bg-blue-600 text-white hover:bg-blue-700']">
                                {{ activeSuspect && activeSuspect.id === suspect.id ? 'ÂΩìÂâçÂàÜÊûê‰∏≠' : 'Êü•ÁúãÂàÜÊûê' }}
                            </button>
                            <button @click="openSuspectModal('append', suspect)"
                                class="flex-1 bg-white border border-gray-300 text-gray-700 py-2 rounded-md text-xs font-medium hover:bg-gray-50 transition-all">
                                ËøΩÂä†Ë¥¶Âçï
                            </button>
                        </div>
                    </div>
                </div>

                <div v-if="suspects.length === 0"
                    class="text-center text-gray-500 py-16 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 mt-6">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                    <p class="text-lg">ÊöÇÊó†Â´åÁñë‰∫∫Êï∞ÊçÆ</p>
                    <p class="text-sm text-gray-400 mt-1">ËØ∑ÁÇπÂáªÂè≥‰∏äËßíÊåâÈíÆÊñ∞Âª∫Â´åÁñë‰∫∫Âπ∂‰∏ä‰º†Ë¥¶Âçï</p>
                </div>

                <!-- Custom Modal -->
                <transition name="fade">
                    <div v-if="showSuspectModal"
                        class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                        <div
                            class="bg-white rounded-2xl shadow-2xl w-full max-w-lg transform transition-all scale-100 p-0 overflow-hidden">
                            <div
                                class="px-6 py-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center">
                                <h3 class="text-lg font-bold text-gray-800">{{ modalMode === 'create' ? 'Êñ∞Âª∫Â´åÁñë‰∫∫Ê°£Ê°à' :
                                    'ËøΩÂä†Ë¥¶Âçï - ' + modalSuspectName }}</h3>
                                <button @click="closeSuspectModal"
                                    class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="p-6">
                                <div v-if="modalMode === 'create'" class="space-y-5 mb-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1.5">Â´åÁñë‰∫∫ÂßìÂêç</label>
                                        <input type="text" v-model="modalSuspectName"
                                            class="w-full border border-gray-300 px-3 py-2.5 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none"
                                            placeholder="ËØ∑ËæìÂÖ•ÁúüÂÆûÂßìÂêç">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1.5">Êü•ÁúãÂØÜÁ†Å <span
                                                class="text-xs text-gray-400 font-normal">(ÊúÄÂ∞ë3‰Ωç)</span></label>
                                        <input type="password" v-model="modalSuspectPassword"
                                            class="w-full border border-gray-300 px-3 py-2.5 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none"
                                            placeholder="ËÆæÁΩÆËÆøÈóÆÂØÜÁ†Å">
                                    </div>
                                </div>

                                <div class="mb-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ë¥¶ÂçïÊñá‰ª∂ <span
                                            class="text-xs text-gray-500 font-normal">(ÊîØÊåÅÂ§öÈÄâ PDF, XLSX,
                                            XLS)</span></label>
                                    <div :class="['border-2 border-dashed transition-colors p-6 text-center rounded-xl bg-gray-50/50 group cursor-pointer', dragOver ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-blue-400']"
                                        @click="$refs.modalFileInput.click()" @dragover.prevent="dragOver = true"
                                        @dragleave.prevent="dragOver = false" @drop.prevent="handleDrop">
                                        <input type="file" ref="modalFileInput" multiple accept=".pdf,.xlsx,.xls"
                                            class="hidden" @change="handleModalFileChange">

                                        <div v-if="modalFiles.length === 0" class="space-y-2">
                                            <div
                                                class="mx-auto h-12 w-12 text-gray-400 group-hover:text-blue-500 transition-colors">
                                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="1.5"
                                                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                                                    </path>
                                                </svg>
                                            </div>
                                            <p class="text-sm text-gray-500 group-hover:text-gray-700">ÁÇπÂáªÈÄâÊã©ÊàñÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§Ñ</p>
                                        </div>

                                        <div v-else class="text-left">
                                            <ul class="max-h-40 overflow-y-auto space-y-2 pr-2 custom-scrollbar">
                                                <li v-for="(file, index) in modalFiles" :key="index"
                                                    class="flex justify-between items-center p-2 bg-white rounded border border-gray-200 shadow-sm text-sm">
                                                    <div class="flex items-center gap-2 truncate">
                                                        <svg class="w-4 h-4 text-red-500 shrink-0" fill="currentColor"
                                                            viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd"
                                                                d="M4 4a2 2 0 012-2h4.586A2 2 0 0111.414 2.586L15 6.172A2 2 0 0115.586 7.586V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"
                                                                clip-rule="evenodd"></path>
                                                        </svg>
                                                        <span class="truncate text-gray-700">{{ file.name }}</span>
                                                    </div>
                                                    <button @click.stop="removeModalFile(index)"
                                                        class="text-gray-400 hover:text-red-500 p-1 rounded-full hover:bg-gray-100 transition-all">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                            viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                        </svg>
                                                    </button>
                                                </li>
                                            </ul>
                                            <div class="mt-3 text-center">
                                                <button class="text-xs text-blue-600 hover:text-blue-800 font-medium">+
                                                    ÁªßÁª≠Ê∑ªÂä†Êñá‰ª∂</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="uploadError"
                                    class="mb-4 p-3 bg-red-50 border border-red-100 rounded-lg flex items-start gap-2">
                                    <svg class="w-5 h-5 text-red-500 shrink-0 mt-0.5" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-red-600 text-sm">{{ uploadError }}</span>
                                </div>

                                <div v-if="uploading && uploadStatus"
                                    class="mb-4 p-3 bg-blue-50 border border-blue-100 rounded-lg text-sm text-blue-700">
                                    {{ uploadStatus }}
                                </div>

                                <div v-if="uploadResult"
                                    class="mb-4 bg-green-50 border border-green-100 rounded-lg p-3 max-h-32 overflow-y-auto text-sm">
                                    <div v-for="(res, idx) in uploadResult" :key="idx"
                                        class="flex items-start gap-2 mb-1 last:mb-0">
                                        <svg class="w-4 h-4 text-green-500 shrink-0 mt-0.5" fill="none"
                                            stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <div class="text-gray-700">
                                            <span class="font-medium text-gray-900">{{ res.filename }}</span>:
                                            Ëß£Êûê {{ res.parsed_count }} Êù°ÔºåÂÖ•Â∫ì {{ res.inserted_count }} Êù°
                                            <span v-if="res.error" class="text-red-500 block ml-0">ÈîôËØØ: {{ res.error
                                                }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 px-6 py-4 flex justify-end gap-3 border-t border-gray-100">
                                <button @click="closeSuspectModal"
                                    class="px-5 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded-lg text-sm font-medium transition-colors">ÂèñÊ∂à</button>
                                <button @click="saveSuspectAndUpload" :disabled="uploading"
                                    class="px-6 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2">
                                    <svg v-if="uploading" class="animate-spin h-4 w-4 text-white"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                            stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                        </path>
                                    </svg>
                                    {{ uploading ? (uploadStatus || 'Â§ÑÁêÜ‰∏≠...') : '‰øùÂ≠òÊ°£Ê°à' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </transition>

                <!-- Manage Modal -->
                <transition name="fade">
                    <div v-if="showManageModal"
                        class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                        <div
                            class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all scale-100 overflow-hidden">
                            <div
                                class="px-6 py-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center">
                                <h3 class="text-lg font-bold text-gray-800">ÁÆ°ÁêÜÂ´åÁñë‰∫∫Ê°£Ê°à</h3>
                                <button @click="showManageModal = false" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="p-6">
                                <h4 class="text-sm font-medium text-gray-700 mb-3">Â∑≤‰∏ä‰º†Ë¥¶ÂçïÊñá‰ª∂</h4>
                                <div v-if="manageFiles.length === 0" class="text-gray-400 text-sm italic mb-6">ÊöÇÊó†Êñá‰ª∂
                                </div>
                                <ul class="max-h-60 overflow-y-auto space-y-2 mb-6 custom-scrollbar">
                                    <li v-for="file in manageFiles" :key="file"
                                        class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border border-gray-100 text-sm">
                                        <span class="truncate text-gray-700 flex-1 mr-2" :title="file">{{ file }}</span>
                                        <button @click="deleteFile(file)"
                                            class="text-red-500 hover:text-red-700 p-1 hover:bg-red-50 rounded transition-colors"
                                            title="Âà†Èô§Ê≠§Êñá‰ª∂">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                                </path>
                                            </svg>
                                        </button>
                                    </li>
                                </ul>
                                <div class="border-t border-gray-100 pt-6">
                                    <button @click="deleteSuspect"
                                        class="w-full py-2.5 bg-red-50 text-red-600 rounded-lg text-sm font-medium hover:bg-red-100 transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                            </path>
                                        </svg>
                                        Âà†Èô§ËØ•Â´åÁñë‰∫∫ÂèäÂÖ∂ÊâÄÊúâÊï∞ÊçÆ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </transition>

                <!-- Verify Modal -->
                <transition name="fade">
                    <div v-if="showVerifyModal"
                        class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                        <div
                            class="bg-white rounded-2xl shadow-2xl w-full max-w-sm transform transition-all scale-100 overflow-hidden">
                            <div class="p-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 text-center">ËØ∑ËæìÂÖ•Êü•ÁúãÂØÜÁ†Å</h3>
                                <input type="password" v-model="verifyPasswordInput" @keyup.enter="verifyPassword"
                                    placeholder="ËæìÂÖ•ÂØÜÁ†Å"
                                    class="w-full border border-gray-300 px-4 py-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none mb-4 text-center tracking-widest">
                                <div class="flex gap-3">
                                    <button @click="showVerifyModal = false"
                                        class="flex-1 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">ÂèñÊ∂à</button>
                                    <button @click="verifyPassword"
                                        class="flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Á°ÆËÆ§</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </transition>
            </div>

            <!-- Dashboard Tab -->
            <div v-if="currentTab === 'dashboard'" class="space-y-6">
                <div v-if="!activeSuspect"
                    class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 flex items-start gap-3">
                    <svg class="w-6 h-6 text-yellow-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                        </path>
                    </svg>
                    <div>
                        <h4 class="font-bold text-yellow-800">Êú™ÈÄâÊã©Â´åÁñë‰∫∫</h4>
                        <p class="text-sm text-yellow-700 mt-1">
                            ËØ∑ÂÖàÂú® <span class="font-bold cursor-pointer underline hover:text-yellow-900"
                                @click="currentTab = 'upload'">Â´åÁñë‰∫∫ÁÆ°ÁêÜ</span> È°µÈù¢ÈÄâÊã©‰∏Ä‰∏™Â´åÁñë‰∫∫„ÄÇ
                        </p>
                    </div>
                </div>
                <div v-else class="hidden">
                </div>

                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex flex-wrap gap-4 items-center">
                        <button @click="resetDashboardFilters"
                            :class="['px-4 py-2 rounded-lg font-medium transition-all text-sm', isAllTime ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-600 hover:bg-gray-200']">
                            ÂÖ®ÈÉ®Êó∂Èó¥
                        </button>
                        <div class="h-6 w-px bg-gray-200 mx-2"></div>
                        <div class="flex items-center gap-2">
                            <span class="text-gray-500 text-sm font-medium">Êó∂Èó¥ËåÉÂõ¥</span>
                            <input type="text" id="dash-start" v-model="dashboardFilters.start_date"
                                class="border border-gray-300 p-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none w-32 transition-all"
                                placeholder="ÂºÄÂßãÊó•Êúü">
                            <span class="text-gray-400">-</span>
                            <input type="text" id="dash-end" v-model="dashboardFilters.end_date"
                                class="border border-gray-300 p-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none w-32 transition-all"
                                placeholder="ÁªìÊùüÊó•Êúü">
                        </div>
                        <div class="h-6 w-px bg-gray-200 mx-2"></div>
                        <div class="flex items-center gap-2">
                            <span class="text-gray-500 text-sm font-medium">Âè™ÁúãÁâπÊÆäÈáëÈ¢ù</span>
                            <div class="relative">
                                <span class="absolute left-3 top-2 text-gray-400 text-sm">¬•</span>
                                <input type="number" step="0.01" v-model="dashboardFilters.specific_amount"
                                    @change="onDashboardFilterChange" placeholder="ËæìÂÖ•ÈáëÈ¢ù(Â¶Ç 598)"
                                    class="border border-gray-300 pl-7 pr-3 py-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none w-56 transition-all">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div
                        class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-2xl border border-green-100 shadow-sm relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                            <svg class="w-24 h-24 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"
                                    clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h3 class="text-green-800 font-medium text-sm uppercase tracking-wider mb-1">ÊÄªÊî∂ÂÖ•</h3>
                        <p class="text-4xl font-bold text-green-600 tracking-tight">¬• {{
                            formatMoney(summary.total_income) }}</p>
                    </div>
                    <div
                        class="bg-gradient-to-br from-red-50 to-rose-50 p-6 rounded-2xl border border-red-100 shadow-sm relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                            <svg class="w-24 h-24 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z"
                                    clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h3 class="text-red-800 font-medium text-sm uppercase tracking-wider mb-1">ÊÄªÊîØÂá∫</h3>
                        <p class="text-4xl font-bold text-red-600 tracking-tight">¬• {{
                            formatMoney(summary.total_expense) }}</p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <span class="w-1 h-6 bg-blue-500 rounded-full"></span>
                                ‰∫§ÊòìÂØπË±° TOP 10 (Êî∂+ÊîØ)
                            </h3>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-gray-500">ÊòæÁ§∫Á©∫‰∫§ÊòìÂØπË±°</span>
                                <button
                                    @click="dashboardFilters.showEmptyCounterparty = !dashboardFilters.showEmptyCounterparty; onDashboardFilterChange()"
                                    :class="['w-10 h-5 rounded-full relative transition-colors duration-200 ease-in-out focus:outline-none', dashboardFilters.showEmptyCounterparty ? 'bg-blue-600' : 'bg-gray-200']">
                                    <span
                                        :class="['absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform duration-200 ease-in-out shadow-sm', dashboardFilters.showEmptyCounterparty ? 'translate-x-5' : 'translate-x-0']"></span>
                                </button>
                            </div>
                        </div>
                        <div ref="pieChart" class="chart-container"></div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <span class="w-1 h-6 bg-purple-500 rounded-full"></span>
                                Êî∂ÊîØË∂ãÂäø
                            </h3>
                            <!-- Day/Night Filter -->
                            <div class="flex bg-gray-100 p-1 rounded-lg">
                                <button @click="setTimeRange('all')"
                                    :class="['px-3 py-1 rounded-md text-xs font-medium transition-all', dashboardFilters.time_range === 'all' ? 'bg-white text-gray-800 shadow-sm' : 'text-gray-500 hover:text-gray-700']">
                                    ÂÖ®Â§©
                                </button>
                                <button @click="setTimeRange('day')"
                                    :class="['px-3 py-1 rounded-md text-xs font-medium transition-all', dashboardFilters.time_range === 'day' ? 'bg-white text-yellow-600 shadow-sm' : 'text-gray-500 hover:text-gray-700']">
                                    ÁôΩÂ§©
                                </button>
                                <button @click="setTimeRange('night')"
                                    :class="['px-3 py-1 rounded-md text-xs font-medium transition-all', dashboardFilters.time_range === 'night' ? 'bg-white text-indigo-600 shadow-sm' : 'text-gray-500 hover:text-gray-700']">
                                    Â§úÈó¥
                                </button>
                            </div>
                        </div>
                        <div ref="lineChart" class="chart-container"></div>
                    </div>
                </div>

                <!-- AI Analysis -->
                <div
                    class="bg-gradient-to-r from-indigo-50 to-blue-50 p-6 rounded-2xl border border-indigo-100 shadow-sm mt-6">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-full">
                            <span class="text-3xl">ü§ñ</span>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-indigo-900 mb-2">AI ‰∫§ÊòìÂàÜÊûêÁÇπËØÑ</h3>
                            <div
                                class="bg-white p-4 rounded-xl rounded-tl-none shadow-sm border border-indigo-100 text-gray-700 leading-relaxed relative min-h-[80px]">
                                <div v-if="loadingAi" class="flex items-center gap-2 text-gray-500 h-full">
                                    <svg class="animate-spin h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg"
                                        fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                            stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                        </path>
                                    </svg>
                                    <span>Ê≠£Âú®ÂàÜÊûê‰∫§ÊòìÊï∞ÊçÆ...</span>
                                </div>
                                <div v-else class="markdown-body whitespace-pre-wrap"
                                    v-html="renderMarkdown(aiAnalysis || 'ÊöÇÊó†ÂàÜÊûêÊï∞ÊçÆ')">
                                </div>
                                <!-- Bubble Tail -->
                                <div
                                    class="absolute top-0 -left-2 w-4 h-4 bg-white border-l border-b border-indigo-100 transform rotate-45">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div v-if="currentTab === 'transactions'" class="space-y-6">
                <!-- No Suspect Warning -->
                <div v-if="!activeSuspect"
                    class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 flex items-start gap-3">
                    <svg class="w-6 h-6 text-yellow-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                        </path>
                    </svg>
                    <div>
                        <h4 class="font-bold text-yellow-800">Êú™ÈÄâÊã©Â´åÁñë‰∫∫</h4>
                        <p class="text-sm text-yellow-700 mt-1">
                            ËØ∑ÂÖàÂú® <span class="font-bold cursor-pointer underline hover:text-yellow-900"
                                @click="currentTab = 'upload'">Â´åÁñë‰∫∫ÁÆ°ÁêÜ</span> È°µÈù¢ÈÄâÊã©‰∏Ä‰∏™Â´åÁñë‰∫∫„ÄÇ
                        </p>
                    </div>
                </div>

                <!-- Active Suspect Banner -->
                <div v-else class="hidden">
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-100 bg-gray-50/30">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <span class="w-1 h-6 bg-blue-600 rounded-full"></span>
                                ‰∫§ÊòìÊòéÁªÜÊü•ËØ¢
                            </h2>
                            <div class="flex gap-3">
                                <button ref="linkageButtonEl" @click="openLinkageGuide"
                                    :class="['text-sm text-indigo-500 border border-indigo-200 bg-indigo-50/50 rounded px-3 py-1 hover:text-indigo-600 hover:font-bold hover:border-indigo-600 hover:bg-indigo-100 flex items-center gap-1 transition-all animate-breathe-blue', showLinkageSpotlight ? 'relative z-[90] ring-4 ring-indigo-300 ring-offset-4 ring-offset-black/0 animate-linkage-wiggle' : '']">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M10 21h7a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v11m0 5l4.879-4.879m0 0a3 3 0 104.243-4.242 3 3 0 00-4.243 4.242z">
                                        </path>
                                    </svg>
                                    ÂèñËØÅËÅîÂä®
                                </button>
                                <button @click="clearFilters"
                                    class="text-sm text-red-400 border border-black rounded px-3 py-1 hover:text-red-600 hover:font-bold hover:border-red-600 hover:bg-red-50 flex items-center gap-1 transition-all">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Ê∏ÖÁ©∫Á≠õÈÄâ
                                </button>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-xs font-medium text-gray-500 mb-1">ÂºÄÂßãÊó•Êúü</label>
                                    <input type="text" id="trans-start" v-model="filters.start_date"
                                        class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                                        placeholder="ÈÄâÊã©Êó•Êúü">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-500 mb-1">ÁªìÊùüÊó•Êúü</label>
                                    <input type="text" id="trans-end" v-model="filters.end_date"
                                        class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                                        placeholder="ÈÄâÊã©Êó•Êúü">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-xs font-medium text-gray-500 mb-1">‰∫§ÊòìÂØπË±°</label>
                                    <div class="relative">
                                        <input type="text" v-model="filters.counterparty"
                                            placeholder="Á≤æÁ°ÆÊêúÁ¥¢‰∫§ÊòìÂØπË±°ÔºåÈÄóÂè∑ÈöîÂºÄÊêúÁ¥¢Â§ö‰∫∫"
                                            class="w-full border border-gray-300 px-3 py-2 pl-9 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                                        <svg class="w-4 h-4 text-gray-400 absolute left-3 top-2.5" fill="none"
                                            stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="flex flex-col md:flex-row gap-4 items-end">
                                <div class="w-full md:w-32">
                                    <label class="block text-xs font-medium text-gray-500 mb-1">Êî∂/ÊîØÁ±ªÂûã</label>
                                    <select v-model="filters.category"
                                        class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white">
                                        <option value="">ÂÖ®ÈÉ®</option>
                                        <option value="Êî∂ÂÖ•">Êî∂ÂÖ•</option>
                                        <option value="ÊîØÂá∫">ÊîØÂá∫</option>
                                    </select>
                                </div>
                                <div class="w-full md:flex-1">
                                    <label class="block text-xs font-medium text-gray-500 mb-1">‰∫§ÊòìÁ±ªÂûã</label>
                                    <input type="text" v-model="filters.transaction_type" placeholder="Â¶ÇÔºöËΩ¨Ë¥¶„ÄÅÁ∫¢ÂåÖ"
                                        class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                                </div>
                                <div class="w-full md:flex-1">
                                    <label class="block text-xs font-medium text-gray-500 mb-1">ÂïÜÂìÅ/ËØ¥Êòé</label>
                                    <input type="text" v-model="filters.method" placeholder="ÂÖ≥ÈîÆËØçÊêúÁ¥¢"
                                        class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                                </div>
                                <div class="w-full md:flex-1">
                                    <label class="block text-xs font-medium text-gray-500 mb-1">ÈáëÈ¢ùËåÉÂõ¥</label>
                                    <div class="flex gap-2">
                                        <input type="number" step="0.01" v-model="filters.min_amount" placeholder="Min"
                                            class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                                        <input type="number" step="0.01" v-model="filters.max_amount" placeholder="Max"
                                            class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                                    </div>
                                </div>
                                <div class="w-full md:w-auto">
                                    <button @click="searchTransactions"
                                        class="w-full md:w-auto bg-blue-600 text-white px-8 py-2 rounded-lg font-medium hover:bg-blue-700 hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 flex items-center justify-center gap-2 whitespace-nowrap">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                        </svg>
                                        Êü•ËØ¢ËÆ∞ÂΩï
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full table-auto">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Êó∂Èó¥</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Á±ªÂûã</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        ‰∫§ÊòìÂØπË±°</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        ÂïÜÂìÅ/ËØ¥Êòé</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        ÈáëÈ¢ù</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Êî∂/ÊîØ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr v-for="t in transactions" :key="t.id" class="hover:bg-gray-50 transition-colors">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{
                                        formatDate(t.transaction_time) }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 cursor-pointer hover:bg-purple-200 transition-colors"
                                            @click="searchTransactionType(t.transaction_type)">
                                            {{ t.transaction_type }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm">
                                        <span class="text-blue-600 cursor-pointer hover:underline font-medium"
                                            @click="searchCounterparty(t.counterparty)">
                                            {{ t.counterparty }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate" :title="t.method">{{
                                        t.method }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono font-medium">{{
                                        formatMoney(t.amount) }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <span
                                            :class="['px-2 inline-flex text-xs leading-5 font-semibold rounded-full', t.category === 'Êî∂ÂÖ•' ? 'bg-green-100 text-green-800' : t.category === 'ÊîØÂá∫' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800']">
                                            {{ t.category }}
                                        </span>
                                    </td>
                                </tr>
                                <tr v-if="transactions.length === 0">
                                    <td colspan="6" class="px-6 py-10 text-center text-gray-500">
                                        <svg class="mx-auto h-12 w-12 text-gray-300" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                            </path>
                                        </svg>
                                        <p class="mt-2 text-sm">ÊöÇÊó†‰∫§ÊòìËÆ∞ÂΩï</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center">
                        <span class="text-sm text-gray-600">
                            ÂÖ± <span class="font-medium text-gray-900">{{ totalTransactions }}</span> Êù°ËÆ∞ÂΩïÔºå
                            ÊÄªÈáëÈ¢ù: <span class="font-bold text-blue-600 font-mono">¬• {{ formatMoney(totalAmount) }}</span>
                        </span>
                        <div class="flex items-center gap-2">
                            <button @click="page > 1 && (page--, fetchTransactions())" :disabled="page === 1"
                                class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                ‰∏ä‰∏ÄÈ°µ
                            </button>
                            <span class="text-sm text-gray-600">
                                Á¨¨ <span class="font-medium">{{ page }}</span> / {{ Math.ceil(totalTransactions / limit)
                                || 1 }} È°µ
                            </span>
                            <button @click="transactions.length === limit && (page++, fetchTransactions())"
                                :disabled="transactions.length < limit"
                                class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                ‰∏ã‰∏ÄÈ°µ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center text-xs text-gray-400 py-6 mt-8">
            <p class="inline-flex items-center gap-1">
                <span>&copy; 2026 Ë¥¶ÂçïÁ•ûÊé¢ - ËÆ∏Èí¶Êªî</span>
                <button @click="openAdminPage"
                    class="w-4 h-4 inline-flex items-center justify-center opacity-[0.03] hover:opacity-40 focus:opacity-40 transition-opacity"
                    title="ÁÆ°ÁêÜ">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </p>
        </footer>
        <!-- Investigation Report Overlay -->
        <transition enter-active-class="transition duration-500 ease-out"
            enter-from-class="transform translate-y-full opacity-0" enter-to-class="transform translate-y-0 opacity-100"
            leave-active-class="transition duration-300 ease-in" leave-from-class="transform translate-y-0 opacity-100"
            leave-to-class="transform translate-y-full opacity-0">
            <div v-if="showReportOverlay"
                :class="['fixed inset-0 z-40 transition-all duration-300 flex flex-col', isReportMinimized ? 'pointer-events-none' : 'bg-black/50 backdrop-blur-sm']">
                <!-- Overlay Container -->
                <div
                    :class="['bg-white shadow-2xl transition-all duration-300 flex flex-col overflow-hidden', 
                        isReportMinimized ? 'absolute bottom-4 right-4 w-96 h-16 rounded-xl border border-gray-200 pointer-events-auto' : 'absolute top-4 left-4 right-4 bottom-4 rounded-xl']">

                    <!-- Header / Control Bar -->
                    <div
                        class="h-12 bg-gray-50 border-b border-gray-200 flex items-center justify-between px-4 shrink-0">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-gray-700 flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-green-500"></span>
                                ÂèñËØÅÊä•Âëä
                            </span>
                        </div>
                        <div class="flex items-center gap-2">
                            <!-- Toggle View Button (Minimize/Restore) -->
                            <button @click="toggleReportView"
                                class="text-sm px-4 py-2 rounded-lg transition-all flex items-center gap-2 shadow-lg hover:scale-105 active:scale-95 animate-pulse-slow"
                                :class="!isReportMinimized 
                                    ? 'bg-gradient-to-r from-indigo-500 to-blue-600 text-white shadow-indigo-500/30 border border-transparent font-bold' 
                                    : 'bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-emerald-500/30 border border-transparent font-bold'"
                                title="ÂàáÊç¢ËßÜÂõæ">
                                <span v-if="!isReportMinimized" class="flex items-center gap-1">
                                    <svg class="w-5 h-5 animate-bounce-slight" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                    ÂõûÂà∞Ë¥¶Âçï
                                </span>
                                <span v-else class="flex items-center gap-1">
                                    <svg class="w-5 h-5 animate-bounce-slight" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 15l7-7 7 7"></path>
                                    </svg>
                                    Êü•ÁúãÊä•Âëä
                                </span>
                            </button>

                            <!-- Change Report -->
                            <button v-if="!isReportMinimized" @click="changeReport"
                                class="text-sm px-3 py-1.5 rounded-lg border border-indigo-200 text-indigo-600 hover:bg-indigo-50 transition-colors flex items-center gap-1 shadow-sm bg-white"
                                title="Êõ¥Êç¢ÂèñËØÅÊä•Âëä">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                    </path>
                                </svg>
                                Êõ¥Êç¢Êä•Âëä
                            </button>

                            <!-- Open in New Tab -->
                            <button v-if="!isReportMinimized" @click="openReportInNewTab"
                                class="text-sm px-3 py-1.5 rounded-lg border border-blue-200 text-blue-600 hover:bg-blue-50 transition-colors flex items-center gap-1 shadow-sm bg-white"
                                title="Âú®Êñ∞Ê†áÁ≠æÈ°µÊâìÂºÄ">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14">
                                    </path>
                                </svg>
                                ÊãÜÂºÄÊòæÁ§∫
                            </button>

                            <!-- Close -->
                            <button @click="closeReportOverlay"
                                class="text-sm px-3 py-1.5 rounded-lg border border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 transition-colors flex items-center gap-1 shadow-sm bg-white ml-2"
                                title="ÂÖ≥Èó≠Êä•Âëä">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                ÈÄÄÂá∫
                            </button>
                        </div>
                    </div>

                    <!-- Iframe Content -->
                    <div class="relative bg-white" :class="isReportMinimized ? 'h-0 overflow-hidden' : 'flex-1'">
                        <iframe :src="reportUrl" class="w-full h-full border-none"></iframe>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Investigation Path Modal -->
        <transition name="fade">
            <div v-if="showInvestigationModal"
                class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                <!-- ... modal content ... -->
                <div
                    class="bg-white rounded-2xl shadow-2xl w-full max-w-lg transform transition-all scale-100 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                            <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2">
                                </path>
                            </svg>
                            ÂèñËØÅÊä•ÂëäËÅîÂä®
                        </h3>
                        <button @click="showInvestigationModal = false" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12">
                                </path>
                            </svg>
                        </button>
                    </div>
                    <div class="p-6">
                        <div class="bg-indigo-50 border border-indigo-100 rounded-lg p-3 mb-4 flex items-start gap-3">
                            <svg class="w-5 h-5 text-indigo-500 mt-0.5 shrink-0" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-sm text-indigo-800">
                                ÂºÄÂêØËÅîÂä®ÂêéÔºåÂú®ÂºπÂá∫ÁöÑÂèñËØÅÊä•ÂëäÁ™óÂè£‰∏≠ÁÇπÂáª‰ªªÊÑèËÅäÂ§©ËÆ∞ÂΩïÊó∂Èó¥ÔºåÊú¨È°µÈù¢Â∞ÜËá™Âä®Á≠õÈÄâÊòæÁ§∫ËØ•Êó∂Èó¥ÂâçÂêéÁöÑË¥¶Âçï„ÄÇ
                            </p>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©ÂèñËØÅÊä•Âëä</label>

                            <div
                                class="bg-yellow-50 border border-yellow-100 rounded-lg p-3 mb-3 text-xs text-yellow-800 space-y-1">
                                <p class="font-bold flex items-center gap-1">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    ‰∏ä‰º†ËØ¥ÊòéÔºö
                                </p>
                                <p>1. ËØ∑Áõ¥Êé•‰∏ä‰º†ÂèñËØÅÊä•ÂëäÂéãÁº©ÂåÖÔºö <span class="font-semibold">zip/rar</span> </p>
                                <p>2. Â¶ÇÂ∑≤ÂÆâË£ÖÊµèËßàÂô®Êèí‰ª∂ÔºåÂèØÁõ¥Êé•Âú®ÊµèËßàÂô®ÊâìÂºÄÊú¨Âú∞Êä•ÂëäÂÖ•Âè£ HTMLÔºàÊó†ÈúÄ‰∏ä‰º†ÔºâÔºåÁÇπÂáªÊó∂Èó¥Ëá™Âä®ÂêåÊ≠•„ÄÇ</p>
                            </div>

                            <div class="space-y-3">
                                <div :class="['border-2 border-dashed transition-colors p-5 text-center rounded-xl bg-gray-50/50 group cursor-pointer', reportArchiveDragOver ? 'border-indigo-500 bg-indigo-50' : 'border-gray-300 hover:border-indigo-400']"
                                    @click="$refs.reportArchiveInput.click()"
                                    @dragover.prevent="reportArchiveDragOver = true"
                                    @dragleave.prevent="reportArchiveDragOver = false"
                                    @drop.prevent="handleReportArchiveDrop">
                                    <input :key="reportArchiveInputKey" type="file" ref="reportArchiveInput"
                                        accept=".zip,.rar" class="hidden" @change="onReportArchiveChange">

                                    <div v-if="!reportArchiveFile" class="space-y-2">
                                        <div
                                            class="mx-auto h-12 w-12 text-gray-400 group-hover:text-indigo-500 transition-colors">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M12 12v9m0 0l-3-3m3 3l3-3">
                                                </path>
                                            </svg>
                                        </div>
                                        <p class="text-sm text-gray-500 group-hover:text-gray-700">ÁÇπÂáªÈÄâÊã©ÊàñÊãñÊãΩÂéãÁº©ÂåÖÂà∞Ê≠§Â§Ñ</p>
                                        <p class="text-xs text-gray-400">‰ªÖÊîØÊåÅ .zip / .rar</p>
                                    </div>

                                    <div v-else class="text-left">
                                        <div
                                            class="flex items-center justify-between p-2 bg-white rounded border border-gray-200 shadow-sm text-sm">
                                            <div class="flex items-center gap-2 truncate">
                                                <svg class="w-4 h-4 text-indigo-500 shrink-0" fill="none"
                                                    stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span class="truncate text-gray-700">{{ reportArchiveFile.name }}</span>
                                            </div>
                                            <button @click.stop="resetReportUploadState"
                                                class="text-gray-400 hover:text-red-500 p-1 rounded-full hover:bg-gray-100 transition-all">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                </svg>
                                            </button>
                                        </div>
                                        <div class="mt-3 text-center">
                                            <button @click.stop="$refs.reportArchiveInput.click()"
                                                class="text-xs text-indigo-600 hover:text-indigo-800 font-medium">ÈáçÊñ∞ÈÄâÊã©</button>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="reportUploading" class="space-y-2">
                                    <div class="flex justify-between text-xs text-gray-600">
                                        <span>{{ reportUploadStatus }}</span>
                                        <span class="font-mono">{{ reportUploadProgress }}%</span>
                                    </div>
                                    <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="h-2 bg-indigo-600 rounded-full transition-all"
                                            :style="{ width: reportUploadProgress + '%' }"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end gap-3 mt-6">
                            <button @click="showInvestigationModal = false" :disabled="reportUploading"
                                class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm transition-colors">ÂèñÊ∂à</button>
                            <button @click="startInvestigation" :disabled="reportUploading"
                                :class="['px-5 py-2 rounded-lg text-sm font-medium shadow-sm hover:shadow-md transition-all flex items-center gap-2', reportUploading ? 'bg-indigo-300 text-white cursor-not-allowed' : 'bg-indigo-600 text-white hover:bg-indigo-700']">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14">
                                    </path>
                                </svg>
                                ‰∏ä‰º†Âπ∂ÊâìÂºÄ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Linkage Promo Popup -->
        <transition enter-active-class="transition duration-500 ease-out"
            enter-from-class="transform translate-y-full opacity-0" enter-to-class="transform translate-y-0 opacity-100"
            leave-active-class="transition duration-300 ease-in" leave-from-class="transform translate-y-0 opacity-100"
            leave-to-class="transform translate-y-full opacity-0">
            <div v-if="showLinkagePromo"
                class="fixed bottom-10 right-10 z-[60] bg-white p-6 rounded-2xl shadow-2xl border border-indigo-100 max-w-sm flex flex-col gap-4">
                <div class="flex items-start gap-4">
                    <div class="bg-indigo-100 p-3 rounded-full shrink-0">
                        <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-800 text-lg mb-1">ÂêØÁî®ÂèñËØÅËÅîÂä®Ôºü</h3>
                        <p class="text-sm text-gray-600 leading-relaxed">
                            ‚ÄúÂèñËØÅËÅîÂä®‚ÄùÂèØÂ∏ÆÂä©ÊÇ®‰∏ÄËæπÊü•ÁúãÊâãÊú∫ÂèñËØÅÊä•Âëä‰∏ÄËæπÊü•ÁúãË¥¶ÂçïÔºåÊòØÂê¶ÂêØÁî®Ôºü
                        </p>
                    </div>
                </div>
                <div class="flex gap-3 justify-end">
                    <button @click="dismissLinkagePromo"
                        class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                        Á®çÂêé
                    </button>
                    <button @click="enableLinkageFromPromo"
                        class="px-5 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all">
                        Á´ãÂç≥ÂêØÁî®
                    </button>
                </div>
            </div>
        </transition>

        <!-- Guidance Toast -->
        <transition enter-active-class="transition duration-500 ease-out"
            enter-from-class="transform -translate-y-4 opacity-0" enter-to-class="transform translate-y-0 opacity-100"
            leave-active-class="transition duration-300 ease-in" leave-from-class="transform translate-y-0 opacity-100"
            leave-to-class="transform -translate-y-4 opacity-0">
            <div v-if="showGuidanceToast"
                class="fixed top-24 right-5 z-50 bg-slate-800/95 backdrop-blur text-white px-5 py-4 rounded-xl shadow-2xl max-w-xs border border-white/10 flex items-start gap-3">
                <div class="text-2xl">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
                <div class="flex-1">
                    <div class="font-bold text-sm mb-1">Ë¥¶ÂçïÁ•ûÊé¢Â∑≤Â∞±Áª™</div>
                    <div class="text-xs text-white/80 leading-relaxed">
                        ÁÇπÂáªÂèñËØÅÊä•Âëä‰∏≠ÁöÑËÅäÂ§©ËÆ∞ÂΩïÊó∂Èó¥ÔºåË¥¶ÂçïÂ∞ÜËá™Âä®Ë∑≥ËΩ¨ÂêåÊ≠•„ÄÇ
                    </div>
                </div>
                <button @click="showGuidanceToast = false" class="text-white/50 hover:text-white transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
        </transition>

        <!-- Feedback Toast -->
        <transition enter-active-class="transition duration-300 ease-out"
            enter-from-class="transform translate-y-4 opacity-0" enter-to-class="transform translate-y-0 opacity-100"
            leave-active-class="transition duration-200 ease-in" leave-from-class="transform translate-y-0 opacity-100"
            leave-to-class="transform translate-y-4 opacity-0">
            <div v-if="feedbackToast.show"
                class="fixed bottom-24 left-1/2 transform -translate-x-1/2 z-50 bg-emerald-500/95 backdrop-blur text-white px-5 py-2.5 rounded-full shadow-lg border border-emerald-400/20 font-medium text-sm flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                {{ feedbackToast.message }}
            </div>
        </transition>

        <transition enter-active-class="transition duration-200 ease-out" enter-from-class="opacity-0"
            enter-to-class="opacity-100" leave-active-class="transition duration-150 ease-in"
            leave-from-class="opacity-100" leave-to-class="opacity-0">
            <div v-if="showLinkageSpotlight" class="fixed inset-0 z-[80]">
                <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" @click="closeLinkageSpotlight"></div>
                <div v-if="linkageSpotlightRect"
                    class="absolute rounded-xl border-2 border-indigo-300 shadow-[0_0_0_6px_rgba(99,102,241,0.25)] pointer-events-none"
                    :style="{ top: linkageSpotlightRect.top + 'px', left: linkageSpotlightRect.left + 'px', width: linkageSpotlightRect.width + 'px', height: linkageSpotlightRect.height + 'px' }">
                </div>
                <div class="absolute z-[85] w-[320px] max-w-[calc(100vw-24px)] bg-white rounded-2xl shadow-2xl border border-indigo-100 p-4"
                    :style="linkageTooltipStyle">
                    <div class="flex items-start gap-3">
                        <div
                            class="bg-indigo-100 text-indigo-700 rounded-full w-9 h-9 flex items-center justify-center shrink-0">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-bold text-gray-900 text-sm mb-1">ÁÇπÂáªËøôÈáåÊü•ÁúãÂèñËØÅËÅîÂä®ÊåáÂºï</div>
                            <div class="text-xs text-gray-600 leading-relaxed">
                                ÂÖàÂú®ÊµèËßàÂô®Âè≥‰∏äËßíÊâìÂºÄÊèí‰ª∂Âπ∂‚ÄúÁªëÂÆöÂΩìÂâçÈ°µÈù¢‚ÄùÔºåÂÜçÊâìÂºÄÊú¨Âú∞ÂèñËØÅÊä•ÂëäÁÇπÂáªÊó∂Èó¥Âç≥ÂèØÂêåÊ≠•„ÄÇ
                            </div>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600" @click.stop="closeLinkageSpotlight">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="flex justify-end gap-2 mt-4">
                        <button class="px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg"
                            @click="closeLinkageSpotlight">Á®çÂêé</button>
                        <button
                            class="px-4 py-1.5 text-sm text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg shadow-sm"
                            @click="openLinkageGuideFromSpotlight">Êü•ÁúãÊåáÂºï</button>
                    </div>
                </div>
            </div>
        </transition>

        <transition enter-active-class="transition duration-200 ease-out" enter-from-class="opacity-0 scale-95"
            enter-to-class="opacity-100 scale-100" leave-active-class="transition duration-150 ease-in"
            leave-from-class="opacity-100 scale-100" leave-to-class="opacity-0 scale-95">
            <div v-if="showLinkageGuideModal"
                class="fixed inset-0 z-[90] bg-gray-900/60 backdrop-blur-sm flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                        <div class="font-bold text-gray-900 flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-indigo-600"></span>
                            ÂèñËØÅËÅîÂä®ÊåáÂºïÔºàÊú¨Âú∞Êä•ÂëäÔºâ
                        </div>
                        <button @click="closeLinkageGuide" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="p-6 space-y-4">
                        <div
                            class="bg-indigo-50 border border-indigo-100 rounded-xl p-4 text-sm text-indigo-900 leading-relaxed">
                            ËØ∑Âú®Ë¥¶ÂçïÁ•ûÊé¢ÁöÑ‚Äú‰∫§ÊòìÊòéÁªÜ‚ÄùÈ°µÈù¢‰øùÊåÅÊâìÂºÄÔºöÁÇπÂáªÊó∂Èó¥ÂèØË∑≥ËΩ¨Âà∞ÂÖ∑‰ΩìÊó∂Èó¥ÔºõÁÇπÂáªÂ§¥ÂÉèÂèØË∑≥ËΩ¨‰∏Ä‰∏™Êó∂Èó¥ÊÆµ„ÄÇ
                        </div>
                        <div class="space-y-3 text-sm text-gray-700">
                            <div class="flex gap-3">
                                <div
                                    class="w-6 h-6 rounded-full bg-gray-900 text-white flex items-center justify-center text-xs font-bold shrink-0">
                                    1</div>
                                <div>ÁúãÊµèËßàÂô®Âè≥‰∏äËßíÔºöÁÇπÂáª‚ÄúÊâ©Â±ï/ÊãºÂõæ‚ÄùÂõæÊ†áÔºåÊâæÂà∞‚ÄúË¥¶ÂçïÁ•ûÊé¢ËÅîÂä®‚ÄùÔºåÂª∫ËÆÆÂõ∫ÂÆöÂà∞Â∑•ÂÖ∑Ê†è„ÄÇ</div>
                            </div>
                            <div class="flex gap-3">
                                <div
                                    class="w-6 h-6 rounded-full bg-gray-900 text-white flex items-center justify-center text-xs font-bold shrink-0">
                                    2</div>
                                <div>ÂõûÂà∞Ë¥¶ÂçïÁ•ûÊé¢È°µÈù¢ÔºåÁÇπÂáªÊâ©Â±ïÂõæÊ†áÔºåÈÄâÊã©‚ÄúÁªëÂÆöÂΩìÂâçÈ°µÈù¢‚Äù„ÄÇ</div>
                            </div>
                            <div class="flex gap-3">
                                <div
                                    class="w-6 h-6 rounded-full bg-gray-900 text-white flex items-center justify-center text-xs font-bold shrink-0">
                                    3</div>
                                <div>Âú®ÊµèËßàÂô®ÊâìÂºÄÊú¨Âú∞ÂèñËØÅÊä•ÂëäÂÖ•Âè£ <span class="font-mono">HTML</span>ÔºàÂú∞ÂùÄ‰ª• <span
                                        class="font-mono">file://</span> ÂºÄÂ§¥Ôºâ„ÄÇ</div>
                            </div>
                            <div class="flex gap-3">
                                <div
                                    class="w-6 h-6 rounded-full bg-gray-900 text-white flex items-center justify-center text-xs font-bold shrink-0">
                                    4</div>
                                <div>Âú®ÂèñËØÅÊä•ÂëäÈáåÁÇπÂáªËÅäÂ§©ËÆ∞ÂΩïÊó∂Èó¥ÊàñÂ§¥ÂÉèÔºöË¥¶ÂçïÁ•ûÊé¢‰ºöËá™Âä®ÂêåÊ≠•Á≠õÈÄâ„ÄÇ</div>
                            </div>
                        </div>
                        <div
                            class="bg-yellow-50 border border-yellow-100 rounded-xl p-4 text-xs text-yellow-900 leading-relaxed">
                            Â¶ÇÊú¨Âú∞Êä•ÂëäÈ°µÊ≤°Êúâ‰ªª‰ΩïÊèêÁ§∫ÔºåËØ∑Âú®Êâ©Â±ïËØ¶ÊÉÖ‰∏≠ÂºÄÂêØ‚ÄúÂÖÅËÆ∏ËÆøÈóÆÊñá‰ª∂ÁΩëÂùÄ‚Äù„ÄÇ
                        </div>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-100 bg-gray-50/50 flex justify-end">
                        <button
                            class="px-5 py-2 rounded-lg text-sm font-medium bg-indigo-600 text-white hover:bg-indigo-700"
                            @click="closeLinkageGuide">ÊàëÁü•ÈÅì‰∫Ü</button>
                    </div>
                </div>
            </div>
        </transition>
    </div>

    <script>
        const { createApp, ref, onMounted, watch, nextTick } = Vue;

        createApp({
            setup() {
                const currentTab = ref('upload');

                // Suspect Management
                const suspects = ref([]);
                const activeSuspect = ref(null);
                const suspectSearch = ref('');
                const showSuspectModal = ref(false);
                const modalMode = ref('create'); // 'create' or 'append'
                const modalSuspectName = ref('');
                const modalSuspectPassword = ref('');
                const modalFiles = ref([]);
                const modalSuspectId = ref(null);

                // Manage & Verify State
                const showManageModal = ref(false);
                const manageFiles = ref([]);
                const manageSuspectId = ref(null);
                const showVerifyModal = ref(false);
                const verifyPasswordInput = ref('');
                const verifyTargetSuspect = ref(null);

                // Dashboard & Transactions
                const summary = ref({ total_income: 0, total_expense: 0 });
                const transactions = ref([]);
                const totalTransactions = ref(0);
                const totalAmount = ref(0);
                const page = ref(1);
                const limit = 20;

                const uploading = ref(false);
                const uploadResult = ref(null);
                const uploadError = ref(null);
                const uploadStatus = ref('');
                const dragOver = ref(false);

                const filters = ref({
                    start_date: '',
                    end_date: '',
                    counterparty: '',
                    category: '',
                    transaction_type: '',
                    method: '',
                    min_amount: '',
                    max_amount: ''
                });

                const dashboardFilters = ref({
                    start_date: '',
                    end_date: '',
                    specific_amount: '',
                    time_range: 'all', // all, day, night
                    showEmptyCounterparty: true
                });

                const aiAnalysis = ref('');
                const loadingAi = ref(false);
                let aiAnalysisRequestId = 0;

                const isAllTime = ref(true);

                // Guidance & Feedback Toasts
                const showGuidanceToast = ref(false);
                const feedbackToast = ref({ show: false, message: '' });
                const showLinkagePromo = ref(false);
                let linkagePromoTimer = null;

                const pieChart = ref(null);
                const lineChart = ref(null);
                let myPieChart = null;
                let myLineChart = null;
                const datePickers = {}; // Store picker instances

                const initDashboardPickers = () => {
                    // Initialize Flatpickr
                    const commonConfig = {
                        locale: "zh",
                        dateFormat: "Y-m-d",
                        disableMobile: true, // Use Flatpickr UI on mobile too for consistency
                        allowInput: true
                    };

                    // Dashboard Start Date
                    if (document.querySelector("#dash-start")) {
                        datePickers.dashStart = flatpickr("#dash-start", {
                            ...commonConfig,
                            onChange: (selectedDates, dateStr) => {
                                dashboardFilters.value.start_date = dateStr;
                                onDashboardFilterChange();
                            }
                        });
                    }

                    // Dashboard End Date
                    if (document.querySelector("#dash-end")) {
                        datePickers.dashEnd = flatpickr("#dash-end", {
                            ...commonConfig,
                            onChange: (selectedDates, dateStr) => {
                                dashboardFilters.value.end_date = dateStr;
                                onDashboardFilterChange();
                            }
                        });
                    }
                };

                const initTransactionPickers = () => {
                    // Initialize Flatpickr for Transactions with Time support
                    const transactionConfig = {
                        locale: "zh",
                        dateFormat: "Y-m-d H:i:S",
                        enableTime: true,
                        enableSeconds: true,
                        time_24hr: true,
                        disableMobile: true, // Use Flatpickr UI on mobile too for consistency
                        allowInput: true
                    };

                    // Transactions Start Date
                    if (document.querySelector("#trans-start")) {
                        datePickers.transStart = flatpickr("#trans-start", {
                            ...transactionConfig,
                            defaultHour: 0,
                            defaultMinute: 0,
                            defaultSeconds: 0,
                            onChange: (selectedDates, dateStr) => {
                                filters.value.start_date = dateStr;
                            }
                        });
                    }

                    // Transactions End Date
                    if (document.querySelector("#trans-end")) {
                        datePickers.transEnd = flatpickr("#trans-end", {
                            ...transactionConfig,
                            defaultHour: 23,
                            defaultMinute: 59,
                            defaultSeconds: 59,
                            onChange: (selectedDates, dateStr) => {
                                filters.value.end_date = dateStr;
                            }
                        });
                    }
                };

                onMounted(() => {
                    loadSuspects();
                    // If no suspects, stay on upload tab.

                    // Listen for investigation reports
                    const channel = new BroadcastChannel('bill_investigation_channel');
                    channel.onmessage = (event) => {
                        if (event.data && event.data.type === 'time_sync') {
                            if (event.data.start_time) {
                                console.log('Received time sync range:', event.data.start_time, '-', event.data.end_time);
                                syncTimeFromReport(event.data.start_time, event.data.end_time);
                            } else if (event.data.time) {
                                // Backward compatibility
                                console.log('Received time sync:', event.data.time);
                                syncTimeFromReport(event.data.time);
                            }
                        }
                    };

                    window.addEventListener('message', (event) => {
                        const data = event && event.data ? event.data : null;
                        if (!data || data.type !== 'BILL_EXTRA_TIME_SYNC') return;
                        console.log('Received extension time sync:', data);
                        if (data.start_time) {
                            syncTimeFromReport(data.start_time, data.end_time);
                        } else if (data.time) {
                            syncTimeFromReport(data.time);
                        }
                    });
                });

                // --- Suspect Methods ---
                const loadSuspects = async () => {
                    let url = '/suspects';
                    // Add cache buster to prevent browser caching of API response
                    const timestamp = new Date().getTime();
                    const separator = url.includes('?') ? '&' : '?';

                    if (suspectSearch.value) {
                        url += `?search=${suspectSearch.value}&t=${timestamp}`;
                    } else {
                        url += `?t=${timestamp}`;
                    }

                    try {
                        const res = await fetch(url);
                        if (res.ok) {
                            const data = await res.json();
                            suspects.value = data;
                            console.log("Loaded suspects:", data.length);
                        }
                    } catch (e) {
                        console.error("Failed to load suspects:", e);
                    }
                };

                const openSuspectModal = (mode, suspect = null) => {
                    modalMode.value = mode;
                    uploadResult.value = null;
                    uploadError.value = null;
                    uploadStatus.value = '';
                    modalFiles.value = [];

                    if (mode === 'create') {
                        modalSuspectName.value = '';
                        modalSuspectPassword.value = '';
                        modalSuspectId.value = null;
                    } else if (mode === 'append' && suspect) {
                        modalSuspectName.value = suspect.name;
                        modalSuspectId.value = suspect.id;
                        // For append, we assume authenticated session or simplified flow
                        modalSuspectPassword.value = '';
                    }
                    showSuspectModal.value = true;
                };

                const closeSuspectModal = () => {
                    showSuspectModal.value = false;
                    loadSuspects(); // Refresh list
                };

                const handleModalFileChange = (e) => {
                    const files = Array.from(e.target.files);
                    addFiles(files);
                    // Reset input so same files can be selected again if needed
                    e.target.value = '';
                };

                const handleDrop = (e) => {
                    dragOver.value = false;
                    const files = Array.from(e.dataTransfer.files);
                    addFiles(files);
                };

                const addFiles = (files) => {
                    // Filter for allowed extensions
                    const allowed = files.filter(f => {
                        const ext = f.name.split('.').pop().toLowerCase();
                        return ['pdf', 'xlsx', 'xls'].includes(ext);
                    });

                    if (allowed.length < files.length) {
                        alert(`Â∑≤ÂøΩÁï• ${files.length - allowed.length} ‰∏™‰∏çÊîØÊåÅÁöÑÊñá‰ª∂„ÄÇ‰ªÖÊîØÊåÅ PDF, XLSX, XLS„ÄÇ`);
                    }

                    modalFiles.value = [...modalFiles.value, ...allowed];
                };

                const removeModalFile = (index) => {
                    modalFiles.value.splice(index, 1);
                };

                const openManageModal = async (suspect) => {
                    manageSuspectId.value = suspect.id;
                    const res = await fetch(`/suspects/${suspect.id}/files`);
                    manageFiles.value = await res.json();
                    showManageModal.value = true;
                };

                const deleteFile = async (filename) => {
                    if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§Êñá‰ª∂ "${filename}" ÂèäÂÖ∂ÊâÄÊúâ‰∫§ÊòìËÆ∞ÂΩïÂêóÔºü`)) return;
                    await fetch(`/suspects/${manageSuspectId.value}/files?filename=${encodeURIComponent(filename)}`, {
                        method: 'DELETE'
                    });
                    const res = await fetch(`/suspects/${manageSuspectId.value}/files`);
                    manageFiles.value = await res.json();
                    loadSuspects();
                };

                const deleteSuspect = async () => {
                    if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËØ•Â´åÁñë‰∫∫ÂèäÂÖ∂ÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) return;
                    await fetch(`/suspects/${manageSuspectId.value}`, {
                        method: 'DELETE'
                    });
                    showManageModal.value = false;
                    if (activeSuspect.value && activeSuspect.value.id === manageSuspectId.value) {
                        activeSuspect.value = null;
                    }
                    loadSuspects();
                };

                const promptVerify = (suspect) => {
                    verifyTargetSuspect.value = suspect;
                    verifyPasswordInput.value = '';
                    showVerifyModal.value = true;
                };

                const verifyPassword = async () => {
                    if (!verifyPasswordInput.value) return;
                    try {
                        const res = await fetch('/suspects/verify', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                suspect_id: verifyTargetSuspect.value.id,
                                password: verifyPasswordInput.value
                            })
                        });
                        if (res.ok) {
                            showVerifyModal.value = false;
                            activeSuspect.value = verifyTargetSuspect.value;
                            currentTab.value = 'dashboard';
                            resetDashboardFilters();

                            // Check if report path is already set for this suspect
                            // We need to fetch the latest suspect data to be sure
                            // (Though verifyTargetSuspect comes from suspects list which is loaded from API)
                            // But let's make sure we have the latest fields
                            const updatedSuspect = suspects.value.find(s => s.id === activeSuspect.value.id);
                            if (updatedSuspect) {
                                activeSuspect.value = updatedSuspect;
                            }
                        } else {
                            alert('ÂØÜÁ†ÅÈîôËØØ');
                        }
                    } catch (e) {
                        alert('È™åËØÅÂ§±Ë¥•');
                    }
                };

                const saveSuspectAndUpload = async () => {
                    uploading.value = true;
                    uploadError.value = null;
                    uploadResult.value = null;
                    uploadStatus.value = '';

                    try {
                        let suspectId = modalSuspectId.value;

                        // 1. Create Suspect if needed
                        if (modalMode.value === 'create') {
                            if (!modalSuspectName.value || !modalSuspectPassword.value) {
                                throw new Error("ËØ∑Â°´ÂÜôÂßìÂêçÂíåÂØÜÁ†Å");
                            }
                            if (modalSuspectPassword.value.length < 3) {
                                throw new Error("ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë3‰Ωç");
                            }

                            const res = await fetch('/suspects', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    name: modalSuspectName.value,
                                    password: modalSuspectPassword.value
                                })
                            });

                            if (!res.ok) {
                                const err = await res.json();
                                throw new Error(err.detail || "ÂàõÂª∫Â´åÁñë‰∫∫Â§±Ë¥•");
                            }
                            const data = await res.json();
                            suspectId = data.id;
                        }

                        // 2. Upload Files if any
                        if (modalFiles.value.length > 0) {
                            const parseJsonResponse = async (res) => {
                                const text = await res.text();
                                let payload = null;
                                try {
                                    payload = text ? JSON.parse(text) : null;
                                } catch (_) {
                                    const snippet = (text || '').trim().slice(0, 200);
                                    throw new Error(`ÊúçÂä°Âô®ËøîÂõûÈùû JSONÔºà${res.status}ÔºâÔºö${snippet || 'empty'}`);
                                }

                                if (!res.ok) {
                                    const detail = (payload && (payload.detail || payload.message)) ? (payload.detail || payload.message) : `‰∏ä‰º†Â§±Ë¥•Ôºà${res.status}Ôºâ`;
                                    throw new Error(detail);
                                }
                                return payload;
                            };

                            const waitForBillJobDone = async (jobId) => {
                                const startedAt = Date.now();
                                while (true) {
                                    const res = await fetch(`/api/bill/upload_status?job_id=${encodeURIComponent(jobId)}`);
                                    const payload = await parseJsonResponse(res);
                                    const status = payload && payload.status ? String(payload.status) : '';

                                    if (status === 'queued') {
                                        uploadStatus.value = 'ÊéíÈòü‰∏≠ÔºàÁ≠âÂæÖÊúçÂä°Âô®Â§ÑÁêÜÔºâ...';
                                    } else if (status === 'processing') {
                                        const idx = payload.current_file_index || 0;
                                        const total = payload.total_files || 0;
                                        const name = payload.current_filename ? String(payload.current_filename) : '';
                                        uploadStatus.value = `ÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠Ôºà${idx}/${total}Ôºâ${name ? 'Ôºö' + name : ''}`;
                                    } else if (status === 'done') {
                                        return payload;
                                    } else if (status === 'error') {
                                        const detail = (payload && payload.detail) ? String(payload.detail) : 'ÊúçÂä°Âô®Â§ÑÁêÜÂ§±Ë¥•';
                                        throw new Error(detail);
                                    } else {
                                        uploadStatus.value = 'ÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠...';
                                    }

                                    if (Date.now() - startedAt > 30 * 60 * 1000) {
                                        throw new Error('ÊúçÂä°Âô®Â§ÑÁêÜË∂ÖÊó∂ÔºåËØ∑Á®çÂêéÈáçËØï');
                                    }
                                    await new Promise(r => setTimeout(r, 1000));
                                }
                            };

                            const formData = new FormData();
                            formData.append('suspect_id', suspectId);
                            modalFiles.value.forEach(file => {
                                formData.append('files', file);
                            });

                            uploadStatus.value = '‰∏ä‰º†‰∏≠...';
                            const resUpload = await fetch('/upload', {
                                method: 'POST',
                                body: formData
                            });

                            const data = await parseJsonResponse(resUpload);
                            let final = data;
                            if (data && data.status === 'accepted' && data.job_id) {
                                uploadStatus.value = 'ÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠...';
                                final = await waitForBillJobDone(data.job_id);
                            } else {
                                uploadStatus.value = '';
                            }

                            const results = Array.isArray(final) ? final : (final && Array.isArray(final.results) ? final.results : null);
                            if (!results) {
                                throw new Error('ÊúçÂä°Âô®ËøîÂõûÊ†ºÂºèÂºÇÂ∏∏');
                            }
                            uploadResult.value = results;

                            // Check for partial errors
                            const hasError = uploadResult.value.some(r => r && r.error);
                            if (!hasError) {
                                modalFiles.value = [];
                                await loadSuspects();

                                const targetSuspect = suspects.value.find(s => s.id === suspectId);
                                if (targetSuspect) {
                                    activeSuspect.value = targetSuspect;
                                    currentTab.value = 'dashboard';
                                    resetDashboardFilters();
                                    showSuspectModal.value = false;

                                    if (modalMode.value === 'create') {
                                        triggerLinkagePromo();
                                    }
                                }
                            }
                        } else if (modalMode.value === 'create') {
                            // Created but no files
                            closeSuspectModal();
                            // We don't trigger promo here because no suspect is active yet
                        }

                    } catch (e) {
                        uploadError.value = e.message;
                        uploadStatus.value = '';
                    } finally {
                        uploading.value = false;
                    }
                };

                // --- Data Fetching ---

                const loadDashboardData = async () => {
                    if (!activeSuspect.value) return;

                    let queryParams = new URLSearchParams();
                    queryParams.append('suspect_id', activeSuspect.value.id);

                    if (dashboardFilters.value.start_date) queryParams.append('start_date', dashboardFilters.value.start_date);
                    if (dashboardFilters.value.end_date) queryParams.append('end_date', dashboardFilters.value.end_date);
                    if (dashboardFilters.value.specific_amount) queryParams.append('specific_amount', dashboardFilters.value.specific_amount);
                    if (dashboardFilters.value.time_range && dashboardFilters.value.time_range !== 'all') {
                        queryParams.append('time_range', dashboardFilters.value.time_range);
                    }

                    const queryString = queryParams.toString() ? `?${queryParams.toString()}` : '';

                    // Summary
                    const resSummary = await fetch(`/stats/summary${queryString}`);
                    summary.value = await resSummary.json();

                    // Charts
                    if (currentTab.value === 'dashboard') {
                        initCharts(queryString);
                    }
                };

                const initCharts = async (queryString = '') => {
                    await nextTick(); // Wait for DOM

                    // Pie Chart
                    const resPie = await fetch(`/stats/by-counterparty?limit=20${queryString ? '&' + queryString.substring(1) : ''}`);
                    let dataPie = await resPie.json();

                    if (!dashboardFilters.value.showEmptyCounterparty) {
                        dataPie = dataPie.filter(item => {
                            const name = item.name;
                            return name && name.trim() !== '' && name !== '/' && name !== '-';
                        });
                    }
                    dataPie = dataPie.slice(0, 10);

                    if (pieChart.value) {
                        if (myPieChart) myPieChart.dispose();
                        myPieChart = echarts.init(pieChart.value);
                        myPieChart.setOption({
                            title: { text: 'Êù•ÂæÄËµÑÈáëÂàÜÂ∏É', left: 'center' },
                            tooltip: { trigger: 'item' },
                            series: [
                                {
                                    name: 'ÈáëÈ¢ù',
                                    type: 'pie',
                                    radius: '50%',
                                    data: dataPie,
                                    emphasis: {
                                        itemStyle: {
                                            shadowBlur: 10,
                                            shadowOffsetX: 0,
                                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                                        }
                                    }
                                }
                            ]
                        });
                        myPieChart.on('click', (params) => {
                            filters.value.counterparty = params.name;
                            filters.value.start_date = dashboardFilters.value.start_date;
                            filters.value.end_date = dashboardFilters.value.end_date;
                            currentTab.value = 'transactions';
                            nextTick(() => {
                                searchTransactions();
                            });
                        });
                    }

                    // Line Chart
                    const resLine = await fetch(`/stats/by-date${queryString}`);
                    const dataLine = await resLine.json();

                    if (lineChart.value) {
                        if (myLineChart) myLineChart.dispose();
                        myLineChart = echarts.init(lineChart.value);
                        myLineChart.setOption({
                            title: { text: 'Êî∂ÊîØË∂ãÂäø', left: 'center' },
                            tooltip: { trigger: 'axis' },
                            legend: { data: ['Êî∂ÂÖ•', 'ÊîØÂá∫'], top: 'bottom' },
                            xAxis: { type: 'category', data: dataLine.dates },
                            yAxis: { type: 'value' },
                            series: [
                                { name: 'Êî∂ÂÖ•', type: 'line', data: dataLine.income, itemStyle: { color: '#10B981' } },
                                { name: 'ÊîØÂá∫', type: 'line', data: dataLine.expense, itemStyle: { color: '#EF4444' } }
                            ]
                        });
                        myLineChart.getZr().on('click', (params) => {
                            const pointInPixel = [params.offsetX, params.offsetY];
                            if (myLineChart.containPixel('grid', pointInPixel)) {
                                const xIndex = myLineChart.convertFromPixel({ seriesIndex: 0 }, pointInPixel)[0];
                                const date = dataLine.dates[xIndex];
                                if (date) {
                                    filters.value.start_date = date;
                                    filters.value.end_date = date;
                                    filters.value.counterparty = ''; // Clear counterparty
                                    currentTab.value = 'transactions';
                                    nextTick(() => {
                                        searchTransactions();
                                    });
                                }
                            }
                        });
                    }

                    // Call AI Analysis
                    if (!activeSuspect.value) return;

                    const requestId = ++aiAnalysisRequestId;
                    const previousAnalysis = aiAnalysis.value;
                    loadingAi.value = true;
                    try {
                        const url = `/stats/ai-analysis${queryString ? queryString + '&' : '?'}suspect_id=${activeSuspect.value.id}`;
                        const resAi = await fetch(url);
                        const text = await resAi.text();
                        let dataAi = null;
                        try {
                            dataAi = text ? JSON.parse(text) : null;
                        } catch (_) {
                            const snippet = (text || '').trim().slice(0, 200);
                            throw new Error(`ÊúçÂä°Âô®ËøîÂõûÈùû JSONÔºà${resAi.status}ÔºâÔºö${snippet || 'empty'}`);
                        }

                        if (!resAi.ok) {
                            const detail = (dataAi && (dataAi.detail || dataAi.message)) ? (dataAi.detail || dataAi.message) : `AI ÂàÜÊûêÂ§±Ë¥•Ôºà${resAi.status}Ôºâ`;
                            throw new Error(detail);
                        }

                        if (requestId === aiAnalysisRequestId) {
                            aiAnalysis.value = dataAi && typeof dataAi.analysis === 'string' ? dataAi.analysis : '';
                        }
                    } catch (e) {
                        if (requestId === aiAnalysisRequestId) {
                            aiAnalysis.value = previousAnalysis || "AI ÂàÜÊûêÂä†ËΩΩÂ§±Ë¥•";
                        }
                    } finally {
                        if (requestId === aiAnalysisRequestId) {
                            loadingAi.value = false;
                        }
                    }
                };

                const fetchTransactions = async () => {
                    if (!activeSuspect.value) return;

                    const skip = (page.value - 1) * limit;
                    let url = `/transactions?skip=${skip}&limit=${limit}&suspect_id=${activeSuspect.value.id}`;
                    if (filters.value.start_date) url += `&start_date=${filters.value.start_date}`;
                    if (filters.value.end_date) url += `&end_date=${filters.value.end_date}`;
                    if (filters.value.counterparty) url += `&counterparty=${filters.value.counterparty}`;
                    if (filters.value.category) url += `&category=${filters.value.category}`;
                    if (filters.value.transaction_type) url += `&transaction_type=${filters.value.transaction_type}`;
                    if (filters.value.method) url += `&method=${filters.value.method}`;
                    if (filters.value.min_amount) url += `&min_amount=${filters.value.min_amount}`;
                    if (filters.value.max_amount) url += `&max_amount=${filters.value.max_amount}`;

                    const res = await fetch(url);
                    const data = await res.json();
                    transactions.value = data.data;
                    totalTransactions.value = data.total;
                    totalAmount.value = data.total_amount;
                };

                const searchTransactions = () => {
                    page.value = 1;
                    fetchTransactions();
                };

                // Watchers
                watch(() => dashboardFilters.value.start_date, (newVal) => {
                    if (datePickers.dashStart && datePickers.dashStart.input && newVal !== datePickers.dashStart.input.value) {
                        datePickers.dashStart.setDate(newVal, false);
                    }
                });
                watch(() => dashboardFilters.value.end_date, (newVal) => {
                    if (datePickers.dashEnd && datePickers.dashEnd.input && newVal !== datePickers.dashEnd.input.value) {
                        datePickers.dashEnd.setDate(newVal, false);
                    }
                });
                watch(() => filters.value.start_date, (newVal) => {
                    if (datePickers.transStart && datePickers.transStart.input && newVal !== datePickers.transStart.input.value) {
                        datePickers.transStart.setDate(newVal, false);
                    }
                });
                watch(() => filters.value.end_date, (newVal) => {
                    if (datePickers.transEnd && datePickers.transEnd.input && newVal !== datePickers.transEnd.input.value) {
                        datePickers.transEnd.setDate(newVal, false);
                    }
                });

                watch(currentTab, (val) => {
                    if (val === 'dashboard') {
                        loadDashboardData();
                        nextTick(() => {
                            initDashboardPickers();
                        });
                    } else if (val === 'transactions') {
                        fetchTransactions();
                        nextTick(() => {
                            initTransactionPickers();
                        });
                    }
                });

                // Helpers
                const formatMoney = (val) => {
                    if (val === null || val === undefined) return '0.00';
                    return Number(val).toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                };

                const formatDate = (str) => {
                    return str ? str.replace('T', ' ') : '';
                };

                const resetDashboardFilters = () => {
                    dashboardFilters.value = {
                        start_date: '',
                        end_date: '',
                        specific_amount: '',
                        time_range: 'all',
                        showEmptyCounterparty: true
                    };
                    isAllTime.value = true;
                    loadDashboardData();
                };

                const onDashboardFilterChange = () => {
                    isAllTime.value = !dashboardFilters.value.start_date && !dashboardFilters.value.end_date && !dashboardFilters.value.specific_amount;
                    loadDashboardData();
                };

                const setTimeRange = (range) => {
                    dashboardFilters.value.time_range = range;
                    loadDashboardData();
                };

                const clearFilters = () => {
                    filters.value = {
                        start_date: '',
                        end_date: '',
                        counterparty: '',
                        category: '',
                        transaction_type: '',
                        method: '',
                        min_amount: '',
                        max_amount: ''
                    };
                    searchTransactions();
                };

                const searchCounterparty = (name) => {
                    filters.value.counterparty = name;
                    searchTransactions();
                };

                const searchTransactionType = (type) => {
                    filters.value.transaction_type = type;
                    searchTransactions();
                };

                // --- Investigation Logic ---
                const showInvestigationModal = ref(false);
                const showReportOverlay = ref(false);
                const reportUrl = ref('');
                const isReportMinimized = ref(false);

                const showLinkageGuideModal = ref(false);
                const showLinkageSpotlight = ref(false);
                const linkageButtonEl = ref(null);
                const linkageSpotlightRect = ref(null);
                const linkageTooltipStyle = ref({ top: '16px', left: '16px' });

                const updateLinkageSpotlight = () => {
                    const el = linkageButtonEl.value;
                    if (!el) return;
                    const rect = el.getBoundingClientRect();
                    linkageSpotlightRect.value = {
                        top: Math.max(8, Math.round(rect.top - 6)),
                        left: Math.max(8, Math.round(rect.left - 6)),
                        width: Math.round(rect.width + 12),
                        height: Math.round(rect.height + 12)
                    };

                    const tooltipWidth = 320;
                    const pad = 12;
                    const top = Math.min(window.innerHeight - pad - 140, rect.top + rect.height + 14);
                    const left = Math.min(window.innerWidth - pad - tooltipWidth, Math.max(pad, rect.left));
                    linkageTooltipStyle.value = { top: `${Math.round(top)}px`, left: `${Math.round(left)}px` };
                };

                const closeLinkageSpotlight = () => {
                    showLinkageSpotlight.value = false;
                };

                const openLinkageGuide = () => {
                    showLinkageSpotlight.value = false;
                    showLinkageGuideModal.value = true;
                    nextTick(() => {
                        updateLinkageSpotlight();
                    });
                };

                const openLinkageGuideFromSpotlight = () => {
                    closeLinkageSpotlight();
                    openLinkageGuide();
                };

                const closeLinkageGuide = () => {
                    showLinkageGuideModal.value = false;
                };

                const startLinkageSpotlight = () => {
                    showLinkageGuideModal.value = false;
                    showLinkageSpotlight.value = true;
                    nextTick(() => {
                        updateLinkageSpotlight();
                    });
                };

                const onSpotlightViewportChange = () => {
                    if (!showLinkageSpotlight.value) return;
                    updateLinkageSpotlight();
                };

                watch(showLinkageSpotlight, (val) => {
                    if (val) {
                        nextTick(() => updateLinkageSpotlight());
                        window.addEventListener('resize', onSpotlightViewportChange);
                        window.addEventListener('scroll', onSpotlightViewportChange, true);
                    } else {
                        window.removeEventListener('resize', onSpotlightViewportChange);
                        window.removeEventListener('scroll', onSpotlightViewportChange, true);
                    }
                });

                const reportArchiveFile = ref(null);
                const reportArchiveInputKey = ref(0);
                const reportUploading = ref(false);
                const reportUploadProgress = ref(0);
                const reportUploadStatus = ref('');
                const reportArchiveDragOver = ref(false);

                const resetReportUploadState = () => {
                    reportArchiveFile.value = null;
                    reportArchiveInputKey.value += 1;
                    reportUploading.value = false;
                    reportUploadProgress.value = 0;
                    reportUploadStatus.value = '';
                    reportArchiveDragOver.value = false;
                };

                const applyReportArchiveFile = (file, inputEl = null) => {
                    if (!file) {
                        resetReportUploadState();
                        return;
                    }

                    const lower = (file.name || '').toLowerCase();
                    if (!(lower.endsWith('.zip') || lower.endsWith('.rar'))) {
                        resetReportUploadState();
                        if (inputEl) inputEl.value = '';
                        alert('‰ªÖÊîØÊåÅ‰∏ä‰º† zip Êàñ rar Ê†ºÂºèÂéãÁº©ÂåÖ');
                        return;
                    }

                    reportArchiveFile.value = file;
                    reportUploading.value = false;
                    reportUploadProgress.value = 0;
                    reportUploadStatus.value = '';
                };

                const onReportArchiveChange = (e) => {
                    const file = (e.target && e.target.files && e.target.files[0]) ? e.target.files[0] : null;
                    applyReportArchiveFile(file, e.target || null);
                };

                const handleReportArchiveDrop = (e) => {
                    reportArchiveDragOver.value = false;
                    const file = (e && e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0]) ? e.dataTransfer.files[0] : null;
                    applyReportArchiveFile(file);
                };

                const uploadReportArchive = (suspectId, file) => {
                    return new Promise((resolve, reject) => {
                        const formData = new FormData();
                        formData.append('suspect_id', String(suspectId));
                        formData.append('file', file, file.name);

                        const xhr = new XMLHttpRequest();
                        let hasAnyProgress = false;

                        reportUploading.value = true;
                        reportUploadProgress.value = 0;
                        reportUploadStatus.value = 'ÂáÜÂ§á‰∏ä‰º†...';

                        const queueHintTimer = setTimeout(() => {
                            if (!hasAnyProgress) {
                                reportUploadStatus.value = 'ÊéíÈòü‰∏≠ÔºàÁ≠âÂæÖÂÖ∂‰ªñ‰∏ä‰º†ÂÆåÊàêÔºâ...';
                            }
                        }, 1200);

                        xhr.upload.onload = () => {
                            clearTimeout(queueHintTimer);
                            reportUploadStatus.value = 'ÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠...';
                            reportUploadProgress.value = Math.max(reportUploadProgress.value, 99);
                        };

                        xhr.upload.onprogress = (evt) => {
                            if (evt && evt.lengthComputable) {
                                hasAnyProgress = true;
                                clearTimeout(queueHintTimer);
                                const percent = Math.min(99, Math.floor((evt.loaded / evt.total) * 100));
                                reportUploadProgress.value = percent;
                                reportUploadStatus.value = '‰∏ä‰º†‰∏≠...';
                            }
                        };

                        xhr.onload = async () => {
                            clearTimeout(queueHintTimer);
                            try {
                                const status = xhr.status || 0;
                                const text = xhr.responseText || '';

                                if (status < 200 || status >= 300) {
                                    let detail = `‰∏ä‰º†Â§±Ë¥•Ôºà${status}Ôºâ`;
                                    try {
                                        const payload = JSON.parse(text);
                                        detail = payload.detail || payload.message || detail;
                                    } catch (_) { }
                                    reject(new Error(detail));
                                    return;
                                }

                                let data = null;
                                try {
                                    data = JSON.parse(text);
                                } catch (_) {
                                    reject(new Error('ÊúçÂä°Âô®ËøîÂõûÊ†ºÂºèÂºÇÂ∏∏'));
                                    return;
                                }

                                resolve(data);
                            } catch (err) {
                                reject(err);
                            }
                        };

                        xhr.onerror = () => {
                            clearTimeout(queueHintTimer);
                            reject(new Error('ÁΩëÁªúÈîôËØØÔºå‰∏ä‰º†‰∏≠Êñ≠'));
                        };

                        xhr.onabort = () => {
                            clearTimeout(queueHintTimer);
                            reject(new Error('‰∏ä‰º†Â∑≤ÂèñÊ∂à'));
                        };

                        xhr.open('POST', '/api/report/upload', true);
                        xhr.send(formData);
                    });
                };

                const openInvestigationModal = () => {
                    openLinkageGuide();
                };

                const startInvestigation = async () => {
                    if (!activeSuspect.value) {
                        alert('ËØ∑ÂÖàÈÄâÊã©Â´åÁñë‰∫∫');
                        return;
                    }
                    if (!reportArchiveFile.value) {
                        alert('ËØ∑ÈÄâÊã©ÂèñËØÅÊä•ÂëäÂéãÁº©ÂåÖÔºàzip/rarÔºâ');
                        return;
                    }

                    try {
                        reportUploadStatus.value = '‰∏ä‰º†‰∏≠...';
                        reportUploadProgress.value = 0;

                        const data = await uploadReportArchive(activeSuspect.value.id, reportArchiveFile.value);

                        const waitForJobDone = async (jobId) => {
                            const startedAt = Date.now();
                            while (true) {
                                const res = await fetch(`/api/report/upload_status?job_id=${encodeURIComponent(jobId)}`);
                                if (!res.ok) {
                                    throw new Error(`‰∏ä‰º†Â§±Ë¥•Ôºà${res.status}Ôºâ`);
                                }
                                const payload = await res.json();
                                const status = payload && payload.status ? String(payload.status) : '';
                                if (status === 'queued') {
                                    reportUploadStatus.value = 'ÊéíÈòü‰∏≠ÔºàÁ≠âÂæÖÊúçÂä°Âô®Â§ÑÁêÜÔºâ...';
                                    reportUploadProgress.value = Math.max(reportUploadProgress.value, 99);
                                } else if (status === 'processing') {
                                    reportUploadStatus.value = 'ÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠...';
                                    reportUploadProgress.value = Math.max(reportUploadProgress.value, 99);
                                } else if (status === 'done') {
                                    return payload;
                                } else if (status === 'error') {
                                    const detail = (payload && payload.detail) ? String(payload.detail) : 'ÊúçÂä°Âô®Â§ÑÁêÜÂ§±Ë¥•';
                                    throw new Error(detail);
                                }

                                if (Date.now() - startedAt > 15 * 60 * 1000) {
                                    throw new Error('ÊúçÂä°Âô®Â§ÑÁêÜË∂ÖÊó∂ÔºåËØ∑Á®çÂêéÈáçËØï');
                                }
                                await new Promise(r => setTimeout(r, 1000));
                            }
                        };

                        let finalData = data;
                        if (data && data.status === 'accepted' && data.job_id) {
                            reportUploadStatus.value = 'ÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠...';
                            reportUploadProgress.value = Math.max(reportUploadProgress.value, 99);
                            finalData = await waitForJobDone(data.job_id);
                        } else {
                            reportUploadStatus.value = 'ÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠...';
                            reportUploadProgress.value = 100;
                        }

                        await loadSuspects();
                        const updated = suspects.value.find(s => s.id === activeSuspect.value.id);
                        if (updated) {
                            activeSuspect.value = updated;
                        }

                        reportUploadProgress.value = 100;
                        const filename = (finalData && finalData.filename) ? finalData.filename : (activeSuspect.value && activeSuspect.value.report_filename) || 'index.html';
                        reportUrl.value = `/report_proxy/${activeSuspect.value.id}/${filename}`;
                        showReportOverlay.value = true;
                        isReportMinimized.value = false;

                        showGuidanceToast.value = true;

                        showInvestigationModal.value = false;
                        resetReportUploadState();
                    } catch (e) {
                        reportUploading.value = false;
                        reportUploadStatus.value = '‰∏ä‰º†Â§±Ë¥•';
                        alert('‰∏ä‰º†Â§±Ë¥•: ' + (e && e.message ? e.message : String(e)));
                    }
                };

                const enableLinkageFromPromo = () => {
                    showLinkagePromo.value = false;
                    if (linkagePromoTimer) clearTimeout(linkagePromoTimer);

                    // Switch to transactions tab first to show the button context
                    currentTab.value = 'transactions';
                    nextTick(() => {
                        startLinkageSpotlight();
                    });
                };

                const dismissLinkagePromo = () => {
                    showLinkagePromo.value = false;
                    if (linkagePromoTimer) clearTimeout(linkagePromoTimer);
                };

                const triggerLinkagePromo = () => {
                    showLinkagePromo.value = true;
                    if (linkagePromoTimer) clearTimeout(linkagePromoTimer);
                    linkagePromoTimer = setTimeout(() => {
                        showLinkagePromo.value = false;
                    }, 20000);
                };

                const toggleReportView = () => {
                    isReportMinimized.value = !isReportMinimized.value;
                };

                const changeReport = () => {
                    resetReportUploadState();
                    showInvestigationModal.value = true;
                };

                const openReportInNewTab = () => {
                    if (reportUrl.value) {
                        window.open(reportUrl.value, '_blank');
                        showReportOverlay.value = false;
                    }
                };

                const closeReportOverlay = () => {
                    showReportOverlay.value = false;
                    reportUrl.value = '';
                };

                const syncTimeFromReport = (startStr, endStr) => {
                    // timeStr format: "2024-03-17 21:48:31"
                    if (!startStr) return;

                    // Switch to transactions tab
                    currentTab.value = 'transactions';

                    // Set filters
                    filters.value.start_date = startStr;
                    filters.value.end_date = endStr || startStr;

                    // Update Flatpickr instances to reflect the new time
                    nextTick(() => {
                        if (datePickers.transStart) {
                            datePickers.transStart.setDate(startStr);
                        }
                        if (datePickers.transEnd) {
                            datePickers.transEnd.setDate(endStr || startStr);
                        }
                    });

                    // Show Feedback Toast
                    let msg = `Â∑≤ÂêåÊ≠•: ${startStr}`;
                    if (endStr && endStr !== startStr) {
                        msg = `Â∑≤ÂêåÊ≠•Âå∫Èó¥: ${startStr} Ëá≥ ${endStr}`;
                    }

                    feedbackToast.value = {
                        show: true,
                        message: msg
                    };
                    setTimeout(() => {
                        feedbackToast.value.show = false;
                    }, 3000);
                    filters.value.counterparty = '';
                    filters.value.category = '';
                    filters.value.transaction_type = '';
                    filters.value.method = '';
                    filters.value.min_amount = '';
                    filters.value.max_amount = '';

                    nextTick(() => {
                        searchTransactions();
                    });
                };

                const renderMarkdown = (text) => {
                    if (!text) return '';
                    // Remove all empty lines to make the output more compact
                    const cleanText = text.replace(/^\s*[\r\n]/gm, '');
                    if (window.marked) {
                        return window.marked.parse(cleanText);
                    }
                    return cleanText;
                };

                const openAdminPage = () => {
                    window.location.href = '/admin';
                };

                return {
                    // Investigation
                    showInvestigationModal,
                    showReportOverlay,
                    reportUrl,
                    isReportMinimized,
                    openInvestigationModal,
                    startInvestigation,
                    syncTimeFromReport,
                    toggleReportView,
                    changeReport,
                    openReportInNewTab,
                    closeReportOverlay,
                    showGuidanceToast,
                    feedbackToast,
                    showLinkagePromo,
                    enableLinkageFromPromo,
                    dismissLinkagePromo,
                    showLinkageGuideModal,
                    showLinkageSpotlight,
                    linkageSpotlightRect,
                    linkageTooltipStyle,
                    openLinkageGuide,
                    openLinkageGuideFromSpotlight,
                    closeLinkageGuide,
                    closeLinkageSpotlight,
                    reportArchiveFile,
                    reportArchiveInputKey,
                    reportUploading,
                    reportUploadProgress,
                    reportUploadStatus,
                    onReportArchiveChange,
                    resetReportUploadState,
                    reportArchiveDragOver,
                    handleReportArchiveDrop,

                    renderMarkdown,
                    openAdminPage,
                    currentTab,
                    // Suspect State
                    suspects,
                    activeSuspect,
                    suspectSearch,
                    showSuspectModal,
                    modalMode,
                    modalSuspectName,
                    modalSuspectPassword,
                    modalFiles,
                    loadSuspects,
                    openSuspectModal,
                    closeSuspectModal,
                    handleModalFileChange,
                    removeModalFile,
                    saveSuspectAndUpload,

                    // Manage & Verify
                    openManageModal,
                    deleteFile,
                    deleteSuspect,
                    promptVerify,
                    verifyPassword,
                    showManageModal,
                    manageFiles,
                    showVerifyModal,
                    verifyPasswordInput,

                    uploading,
                    uploadResult,
                    uploadError,
                    uploadStatus,
                    summary,
                    transactions,
                    totalTransactions,
                    totalAmount,
                    page,
                    limit,
                    filters,
                    pieChart,
                    lineChart,
                    dashboardFilters,
                    aiAnalysis,
                    loadingAi,
                    isAllTime,
                    resetDashboardFilters,
                    onDashboardFilterChange,
                    setTimeRange,
                    formatMoney,
                    formatDate,
                    fetchTransactions,
                    searchTransactions,
                    clearFilters,
                    searchCounterparty,
                    searchTransactionType,
                    dragOver,
                    handleDrop
                };
            }
        }).mount('#app');
    </script>
</body>

</html>